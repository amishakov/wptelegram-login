!function(r,n){"use strict";var o={configure:function(){o.metabox=r("#cmb2-metabox-wptelegram_login"),o.bot_token=o.metabox.find("#bot_token"),o.bot_username=o.metabox.find("#bot_username")},set_read_only_fields:function(){o.bot_username.prop("readonly",!0),o.metabox.find("#avatar_meta_key").prop("readonly",!0)},init:function(){o.configure(),o.set_read_only_fields(),o.check_redirect_to(),o.metabox.on("blur","#bot_token,#bot_username",o.handle_blur),o.metabox.on("click","#button-bot_token",o.test_bot_token),o.metabox.on("dblclick","#bot_username,#avatar_meta_key",o.handle_double_click),o.metabox.on("change","input[type=checkbox][name=disable_signup],input[type=checkbox][name=show_message_on_error]",o.toggle_dependents),o.metabox.on("change","input[type=radio][name=redirect_to]",o.check_redirect_to),o.metabox.on("change","input[type=radio][name=button_style],#corner_radius",o.fix_corner_radius),o.metabox.find("input[type=checkbox][name=disable_signup],input[type=checkbox][name=show_message_on_error]").trigger("change")},test_bot_token:function(){if(o.bot_token.val().trim()){if(o.validate("bot_token")){var e=r(this).attr("data-id"),t=o[e].val().replace(/[\s@]/g,"");switch(e){case"bot_token":o.handle_test_bot_token(t)}}}else window.alert(n.empty_bot_token)},handle_test_bot_token:function(e){o.send_ajax_request(e,"/getMe",{},o.handle_bot_token_test)},send_ajax_request:function(e,t,a,n){var o="https://api.telegram.org/bot"+e+t;r.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:o,dataType:"json",crossDomain:!0,data:JSON.stringify(a),complete:n})},handle_blur:function(){o.metabox.find(".info").addClass("hidden").siblings().remove();var e=r(this).attr("id");""!=o[e].val()&&o.validate(e)},handle_double_click:function(){r(this).prop("readonly",!1).focus()},check_redirect_to:function(){var e=o.metabox.find("input[type=radio][name=redirect_to]:checked").val(),t=o.metabox.find("#redirect_url");"custom_url"!=e?t.hide():t.show()},toggle_dependents:function(){var e=r(this),t=e.attr("id");console.log(e.val());var a=e.is(":checked")?"on":"off";o.metabox.find('[data-the-conditional-id="'+t+'"]').each(function(){var e=r(this).closest(".cmb-row");a===r(this).attr("data-the-conditional-value")?e.show():e.hide()})},fix_corner_radius:function(e){var t,a=o.metabox.closest("#wptelegram_login").get(0);"corner_radius"==e.target.id?(t=a.corner_radius.value.replace(/[^0-9]+/g,""),a.corner_radius.realValue=t):(t=(a.corner_radius.realValue||a.corner_radius.defaultValue).replace(/[^0-9]+/g,""),a.corner_radius.value=t),""!=t&&((t=parseInt(t,10))<=0?a.corner_radius.value=0:"small"==a.button_style.value&&10<t?a.corner_radius.value=10:"medium"==a.button_style.value&&14<t?a.corner_radius.value=14:"large"==a.button_style.value&&20<t?a.corner_radius.value=20:a.corner_radius.value!=t.toString()&&(a.corner_radius.value=t))},handle_bot_token_test:function(e){var t=o.metabox.find("#bot_token-info");if(t.removeClass("hidden"),null==e||""==e.responseText)t.text(""),t.append("<span>"+n.error+" "+n.could_not_connect+"</span>");else if(1==JSON.parse(e.responseText).ok){var a=JSON.parse(e.responseText).result;t.text(a.first_name+" "+(null==a.last_name?" ":a.last_name)+"(@"+a.username+")"),o.bot_username.val(a.username)}else t.text(n.error+" "+e.status+" ("+e.statusText+")")},validate:function(e){var t,a=o.metabox.find("#"+e).val().replace(/[\s@]/g,"");switch(o.metabox.find("#"+e).val(a),e){case"bot_token":t=new RegExp(/^\d{9}:[\w-]{35}$/);break;case"bot_username":t=new RegExp(/^[a-z]\w{3,30}[^\W_]$/i)}return t.test(a)?(o.metabox.find("#"+e+"-err").addClass("hidden"),!0):(o.metabox.find("#"+e+"-err").removeClass("hidden"),!1)}};r(document).ready(o.init)}(jQuery,wptelegram_login_I18n);