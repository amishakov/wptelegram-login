!function(r,o){"use strict";var i={configure:function(){i.metabox=r("#cmb2-metabox-wptelegram_login"),i.bot_token=i.metabox.find("#bot_token"),i.bot_username=i.metabox.find("#bot_username")},set_read_only_fields:function(){i.bot_username.prop("readonly",!0),i.metabox.find("#avatar_meta_key").prop("readonly",!0)},init:function(){i.configure(),i.set_read_only_fields(),i.check_redirect_to(),i.metabox.on("blur","#bot_token,#bot_username",i.handle_blur),i.metabox.on("click","#button-bot_token",i.test_bot_token),i.metabox.on("dblclick","#bot_username,#avatar_meta_key",i.handle_double_click),i.metabox.on("change","input[type=checkbox][name=disable_signup]",i.toggle_disable_signup_dependents),i.metabox.on("change","input[type=radio][name=redirect_to]",i.check_redirect_to),i.metabox.on("change","input[type=radio][name=button_style],#corner_radius",i.fix_corner_radius),i.metabox.find("input[type=checkbox][name=disable_signup]").trigger("change")},test_bot_token:function(e,t){if(i.bot_token.val().trim()){if(i.validate("bot_token")){var a=r(this).attr("data-id"),n=i[a].val().replace(/[\s@]/g,"");switch(a){case"bot_token":i.handle_test_bot_token(n)}}}else alert(o.empty_bot_token)},handle_test_bot_token:function(e){i.send_ajax_request(e,"/getMe",{},i.handle_bot_token_test)},send_ajax_request:function(e,t,a,n){var o="https://api.telegram.org/bot"+e+t;r.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:o,dataType:"json",crossDomain:!0,data:JSON.stringify(a),complete:n})},handle_blur:function(e){i.metabox.find(".info").addClass("hidden").siblings().remove();var t=r(this).attr("id");""!=i[t].val()&&i.validate(t)},handle_double_click:function(e){r(this).prop("readonly",!1).focus()},check_redirect_to:function(e){var t=i.metabox.find("input[type=radio][name=redirect_to]:checked").val(),a=i.metabox.find("#redirect_url");"custom_url"!=t?a.hide():a.show()},toggle_disable_signup_dependents:function(e){var t=r(this),a=t.attr("id"),n=i.metabox.find('[data-the-conditional-id="'+a+'"]').closest(".cmb-row");t.is(":checked")?n.hide():n.show()},fix_corner_radius:function(e){var t=i.metabox.closest("#wptelegram_login").get(0);if("corner_radius"==e.target.id){var a=t.corner_radius.value.replace(/[^0-9]+/g,"");t.corner_radius.realValue=a}else{a=(t.corner_radius.realValue||t.corner_radius.defaultValue).replace(/[^0-9]+/g,"");t.corner_radius.value=a}""!=a&&((a=parseInt(a))<=0?t.corner_radius.value=0:"small"==t.button_style.value&&10<a?t.corner_radius.value=10:"medium"==t.button_style.value&&14<a?t.corner_radius.value=14:"large"==t.button_style.value&&20<a?t.corner_radius.value=20:t.corner_radius.value!=a.toString()&&(t.corner_radius.value=a))},handle_bot_token_test:function(e,t){var a=i.metabox.find("#bot_token-info");if(a.removeClass("hidden"),null==e||""==e.responseText)a.text(""),a.append("<span>"+o.error+" "+o.could_not_connect+"</span>");else if(1==JSON.parse(e.responseText).ok){var n=JSON.parse(e.responseText).result;a.text(n.first_name+" "+(null==n.last_name?" ":n.last_name)+"(@"+n.username+")"),i.bot_username.val(n.username)}else a.text(o.error+" "+e.status+" ("+e.statusText+")")},validate:function(e){var t,a=i.metabox.find("#"+e).val().replace(/[\s@]/g,"");switch(i.metabox.find("#"+e).val(a),e){case"bot_token":t=new RegExp(/^\d{9}:[\w-]{35}$/);break;case"bot_username":t=new RegExp(/^[a-z]\w{3,30}[^\W_]$/i)}return t.test(a)?(i.metabox.find("#"+e+"-err").addClass("hidden"),!0):(i.metabox.find("#"+e+"-err").removeClass("hidden"),!1)}};r(document).ready(i.init)}(jQuery,wptelegram_login_I18n);